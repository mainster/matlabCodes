%% Muschelplot @Mitch 
% Das Verbrauchskennfeld, auch Muscheldiagramm, Muschelkurve oder
% Wirkungsgradkennfeld[1] genannt, stellt den spezifischen
% Kraftstoffverbrauch in g/kWh über dem effektiven Mitteldruck und der
% Drehzahl eines Verbrennungsmotors dar.

%% Beispieldatensatz
% http://www.gomatlab.de/verbrauchskennfeld-eines-dieselmotors-erstellen-t40762.html
% | n | 100% | 80% | 60% | 40% | 20% | 5% |

% 100% 80% 60% 40% 20% 5%

MitteldruckPME=...
[[nan            1			.8			.6			.4          .2         .05];...
[1000	5.09613763	4.06729634	3.03929836	2.03575645	0.98498904	0.25383707];...
[1400	6.26581211	4.95024456	3.65913307	2.45403947	1.21858661	0.30190589];...
[1500	6.91516276	5.49839771	4.14909766	2.7660651	1.35773318	0.34575814];...
[1600	7.10912464	5.67549334	4.26716141	2.82509698	1.3998988	0.36262439];...
[1750	7.15972339	5.75139147	4.32619329	2.90942823	1.45049755	0.37105751];...
[1800	7.08382527	5.62489459	4.29246079	2.84196323	1.41676505	0.35419126];...
[2000	7.10069152	5.63332771	4.16596391	2.78293135	1.40833193	0.36262439];...
[2100	7.07539214	5.73452522	4.23342891	2.83353011	1.3998988	0.35419126];...
[2200	7.18502277	5.68392646	4.25872828	2.84196323	1.42519818	0.34575814];...
[2400	7.16815652	5.73452522	4.30089391	2.86726261	1.42519818	0.36262439];...
[2500	6.30713442	5.05312869	3.98212177	2.53837072	1.24135605	0.35081801];...
[2600	6.60313712	5.2960027	3.94585934	2.7053466	1.35435993	0.35419126];...
[2750	7.42115028	5.93692022	4.41052454	2.97689324	1.46736381	0.35419126];...
[2800	7.13442402	5.72609209	4.27559454	2.84196323	1.40833193	0.35419126];...
[3000	7.3958509	5.95378647	4.46112329	2.98532636	1.46736381	0.36262439];...
[3400	7.27778715	5.91162085	4.41052454	2.82509698	1.40833193	0.32045876]];

VerbrauchBE=...
[[nan            1			.8			.6			.4          .2         .05];...
[1000	364.757255	353.898226	363.649164	387.578766	661.668292	1879.00604];...
[1400	343.609982	309.460675	317.234477	371.820554	529.879731	1594.67354];...
[1500	305.912915	285.601464	287.053258	323.530599	492.517921	1387.20672];...
[1600	283.932371	258.242751	262.153845	298.581665	422.463609	1205.45747];...
[1750	287.787612	264.99374	278.254583	308.914446	437.053636	1214.07729];...
[1800	306.730799	280.813073	285.57421	326.781581	460.161025	2851.17494];...
[2000	309.01993	276.414075	282.139232	324.003403	380.35955	1294.73205];...
[2100	321.989532	275.622222	282.418936	323.788365	450.863506	1275.38307];...
[2200	321.849461	272.681876	284.783386	321.107173	455.25362	1325.60683];...
[2400	298.065145	275.082051	282.276585	331.279012	472.813593	1353.35725];...
[2500	332.688627	309.171506	315.904808	368.005134	545.937039	1508.04477];...
[2600	325.217944	302.295505	316.176566	355.402814	515.930189	1412.60562];...
[2750	295.949274	268.742737	284.418705	323.779075	468.684609	1399.64285];...
[2800	302.315168	278.900041	290.684828	340.449392	505.301652	1451.67274];...
[3000	381.481496	281.781125	290.779552	328.735519	492.149617	1449.72016];...
[3400	326.801406	292.065574	306.671471	353.737943	529.982814	1780.88884]];

%%

rpm = VerbrauchBE(2:end,1)'
throttle = VerbrauchBE(1, 2:end)*100
PME100 = [5.09 6.26 6.91 7.11 7.16 7.08 7.10 7.08 7.19 7.17 6.31 6.60 7.42 7.13 7.40 7.28];
PME80 = PME100*0.8;
PME60 = PME100*0.6;
PME40 = PME100*0.4;
PME20 = PME100*0.2;
PME5  = PME100*0.05;

[X,Y] = meshgrid(rpm,throttle);
Z = [PME100; PME80; PME60; PME40; PME20; PME5];

figure(1)
contour(X,Y,Z)

return
%%

% http://www.stufenlosgetriebe.de/Stufenlosgetriebe.de/Matlab_Simulink/Eintrage/2013/6/8_Kennfelder_mit_Matlab_interpolieren.html
%
% Hier eine Beispielprogrammierung für ein Wandler-Kennfeld (Drehmomentwandler):
% Randbedingungen
n3_max=20000;
k3_status='offen';
i_stufe_0_1=2;
M_antrieb_max_zug=500;
M_antrieb_max_schub=400;
wandler_M_max_zug=M_antrieb_max_zug/i_stufe_0_1;
J_SW=0.2;

% Wandlerkennlinie
n_verh_kennlinie =   [0   0.1   0.2   0.3   0.4   0.5   0.6   0.7   0.8   0.9   1    1.1   1.2   1000  10000000];
M_ueberh_kennlinie =  [1.6 1.53  1.46  1.4   1.33  1.26  1.2   1.13  1.06  1     0    0.8   0.8   0.8   0.8];

%Betriebspunkt im Wandler
n_verh=n_turbine/n_pumpe;
M_ueberh=interp1(n_verh_kennlinie, M_ueberh_kennlinie, n_verh);
M_Turbine=M_ueberh*M_Pumpe;